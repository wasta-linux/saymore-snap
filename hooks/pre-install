#!/bin/env bash

# Reset DLL overrides after wineboot --init & dotnet48 installation.
export WINEDLLOVERRIDES=

# Copy wine-gecko to .cache/wine and install.
geckos=( "wine-gecko-2.47.2-x86.msi" "wine-gecko-2.47.2-x86_64.msi" )
if [[ -n "$SNAP_USER_COMMON" ]]; then
    winecache="${XDG_CACHE_HOME}/wine"
    mkdir -p "$winecache"
    for g in "${geckos[@]}"; do
        cp -f "${SNAP}/data/${g}" "$winecache"
        "$WINELOADER" msiexec /i "${winecache}/${g}"
    done
fi

# Use local SayMoreInstaller.*.msi if path is set.
if [[ -e "$INSTALL_EXE" ]]; then
    export INSTALL_URL=
fi

# Match SayMore language UI to system locale.
export LC_ALL="$LANG"

# Set default DPI.
if [[ -z "$WINEDPI" ]]; then
    export WINEDPI=108
fi

# Set Winver to 10.
"$WINELOADER" winecfg /v win10
